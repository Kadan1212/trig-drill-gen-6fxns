<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trig Drill Generator</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <style>
/* FRACTIONS & SQUARE ROOTS */
.frac { display:inline-block; vertical-align:middle; text-align:center; font-size:0.5em; margin:0 0.1em; }
.numer { display:table; border-bottom:0.03em solid currentColor; vertical-align:middle; }
.sqrt { margin:0 0.1em; position:relative; }
.sqrt::before { content:'√'; }
.sqrt::after { content:''; display:block; position:absolute; top:0.25em; left:0.9ch; right:0; border-top:0.03em solid currentColor; height:1px; }

/* BASE STYLES */
html,body {
  height:100%;
  width:100%;
  margin:0;
  font-family:"Open Sans",sans-serif;
  color:#333;
  background:#fbfbfb;
  --problem-n:0;
  font-size:0;
  overflow:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
}

/* CONTAINER STATES */
body.show-intro-modal .intro-modal { display:flex; }
body.show-intro-modal .solutions { display:none; }
body.show-solutions .solutions { display:grid; }
body.show-intro-modal .problems { display:none; }
body.show-score .intro-modal.not-score { display:none; }

/* MODALS */
.intro-modal {
  position: relative;  /* add this */
  z-index: 10;         /* add this */
  box-shadow:0 3px 20px rgba(0,0,0,0.45);
  border-radius:20px;
  padding:28px;
  display:none;
  flex-direction:column;
  width:380px;
  box-sizing:border-box;
  background:white;
}
h1 { margin:0 0 12px 0; font-weight:normal; font-size:28px; }
h2 { margin:0 0 12px 0; font-weight:normal; color:#666; font-size:14px; }
#start,#menu {
  background:#2092e3;
  color:white;
  border:none;
  padding:10px;
  border-radius:10px;
  font-size:16px;
  cursor:pointer;
  width:100%;
  margin-top:10px;
}
.options { max-height:40vh; overflow:auto; margin-top:6px; }
.options p { margin:8px 0; font-size:14px; }
.options label, .options input[type=checkbox] { cursor:pointer; }

/* PROBLEMS AREA */
.problems {
  padding-top:40vh;
  margin-top:calc(var(--problem-n) * -20vh);
  transition:margin-top .2s;
  width:50vw;
  box-sizing:border-box;
}
.problem {
  font-size:14vh;
  font-family:serif;
  padding:3vh 3vw;
  width:50vw;
  min-width:50vh;
  height:20vh;
  border-right:3px solid rgba(0,0,0,0.08);
  box-sizing:border-box;
  text-align:right;
  opacity:0.5;
  position:relative;
  transition:opacity .15s, color .15s, background .15s;
}
.problem.current { opacity:1; color:#000; background:transparent; }
.answer {
  position:absolute;
  left:10px;
  top:0;
  bottom:0;
  display:flex;
  align-items:center;
  opacity:0;
  font-size:0.5em;
  transition:opacity .15s;
}
.problem.correct { color:#0a530a; }
.problem.wrong { color:#d12525; }
.problem.correct .answer, .problem.wrong .answer { opacity:1; }

/* SOLUTIONS GRID */
.solutions {
  z-index:20;
  pointer-events:auto;
  width:36vw;
  position:fixed;
  right:0;
  top:0;
  height:100%;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  grid-auto-rows:1fr;
  gap:16px;
  padding:24px;
  box-sizing:border-box;
  align-content:center;
  justify-items:stretch;
}

/* SCORE MODAL */
.intro-modal.score { display:none; width:500px; }
body.show-score .intro-modal.score { display:flex; }
body.show-score .intro-modal.not-score { display:none; }

/* RESPONSIVE */
@media (max-width: 900px) {
  .intro-modal { width:320px; }
  .solutions {
    position:fixed;
    bottom:0;
    top:auto;
    width:100%;
    height:50vh;
    grid-template-columns: repeat(3,1fr);
    padding:14px;
    gap:10px;
  }
  .problems, .problem { width:100vw; min-width:0; }
}
  </style>
</head>
<body class="show-intro-modal">

  <!-- intro (options) -->
  <div class="intro-modal not-score">
    <h1>Trig Drill Generator</h1>
    <h2>Options</h2>
    <div class="options">
      <p><input type="checkbox" id="degrees" checked> <label for="degrees">Degrees?</label></p>
      <p><input type="checkbox" id="radian" checked> <label for="radian">Radians?</label></p>

      <p><input type="checkbox" id="tan" checked> <label for="tan">Include tan problems?</label></p>
      <p><input type="checkbox" id="cot" checked> <label for="cot">Include cot problems?</label></p>
      <p><input type="checkbox" id="sec" checked> <label for="sec">Include sec problems?</label></p>
      <p><input type="checkbox" id="csc" checked> <label for="csc">Include csc problems?</label></p>

      <p><input type="checkbox" id="deg90s" checked> <label for="deg90s">Include 90°-type angles?</label></p>
      <p><input type="checkbox" id="deg30s" checked> <label for="deg30s">Include 30° & 60° angles?</label></p>
      <p><input type="checkbox" id="deg45s" checked> <label for="deg45s">Include 45° angles?</label></p>
      <p><input type="checkbox" id="include360" checked> <label for="include360">Include 360°?</label></p>

      <p><input type="checkbox" id="coterminal" checked> <label for="coterminal">Include coterminal angles?</label></p>
      <p><input type="checkbox" id="quadionly"> <label for="quadionly">Limit to quadrant I angles?</label></p>

      <p><input type="checkbox" id="showcorrectness" checked> <label for="showcorrectness">Show wrong answers?</label></p>
      <p><input type="checkbox" id="showcorrect" checked> <label for="showcorrect">Show correct answers?</label></p>
      <p><input type="checkbox" id="showtime" checked> <label for="showtime">Show time?</label></p>
      <p><input type="checkbox" id="limit20"> <label for="limit20">Limit to twenty problems?</label></p>
    </div>
    <button id="start">Start</button>
  </div>

  <!-- score modal (only shown at end) -->
  <div class="intro-modal score">
    <div id="score" class="score"></div>
    <button id="menu">Menu</button>
  </div>

  <!-- problems column (center) -->
  <div class="problems" id="problems" aria-live="polite"></div>

<!-- SOLUTIONS BUTTONS -->
<div class="solutions" id="solutions">
  <div class="solution" data-answer="1/2">1/2</div>
  <div class="solution" data-answer="rt2/2">√2/2</div>
  <div class="solution" data-answer="rt3/2">√3/2</div>

  <div class="solution" data-answer="1">1</div>
  <div class="solution" data-answer="0">0</div>
  <div class="solution" data-answer="null">undefined</div>

  <div class="solution" data-answer="rt3/3">√3/3</div>
  <div class="solution" data-answer="rt3">√3</div>
  <div class="solution" data-answer="rt2">√2</div>

  <div class="solution" data-answer="(2rt3)/3">(2√3)/3</div>
  <div class="solution" data-answer="1/3">1/3</div>
  <div class="solution" data-answer="3/2">3/2</div>

   <!-- solutions (3 x 4 grid) -->
    <!-- Row 1 -->
    <div class="solution" data-key="Q" data-answer="1/2"><span class="frac"><span class="numer">1</span><span class="denom">2</span></span></div>
    <div class="solution" data-key="W" data-answer="rt2/2"><span class="frac"><span class="numer"><span class="sqrt">2</span></span><span class="denom">2</span></span></div>
    <div class="solution" data-key="E" data-answer="rt3/2"><span class="frac"><span class="numer"><span class="sqrt">3</span></span><span class="denom">2</span></span></div>

    <!-- Row 2 -->
    <div class="solution" data-key="R" data-answer="1"><span>1</span></div>
    <div class="solution" data-key="T" data-answer="0"><span>0</span></div>
    <div class="solution" data-key="Y" data-answer="null"><span style="font-size:4vh;">undefined</span></div>

    <!-- Row 3 -->
    <div class="solution" data-key="U" data-answer="rt3/3"><span>√3/3</span></div>
    <div class="solution" data-key="I" data-answer="rt3"><span>√3</span></div>
    <div class="solution" data-key="O" data-answer="rt2"><span>√2</span></div>

    <!-- Row 4 -->
    <div class="solution" data-key="P" data-answer="2"><span>2</span></div>
    <div class="solution" data-key="A" data-answer="1/3"><span>1/3</span></div>
    <div class="solution" data-key="S" data-answer="2rt3/3"><span>2√3/3</span></div>
</div>

<div class="clock" id="clock">3:00</div>

<script>
console.log(document.getElementById('start'));
document.addEventListener('DOMContentLoaded', () => {
/* ---------- core drill generator (cleaned up) ---------- */

/* Helper: invert many of our string representations into their reciprocals.
   Supports the specific strings we use in the app (rt2/2, rt3/2, rt3/3, rt2, rt3, 1/2, etc.)
*/
function invert(value) {
  if (value === 0) return null;
  if (value === null) return 0;
  if (typeof value === 'number') return 1 / value;
  const neg = (''+value).startsWith('-');
  const v = neg ? value.slice(1) : value;

  // map common rational/surd forms -> reciprocal form
  const map = {
    '1/2': '2',
    'rt2/2': 'rt2',
    'rt3/2': '2/rt3',
    'rt3/3': 'rt3',
    'rt2': 'rt2/2',
    'rt3': 'rt3/3',
    '2': '1/2',
    '1/3': '3',
    '3/2': '2/3',
    '2rt3/3': '(2√3)/3'
  };
  const res = map[v] || (1 / parseFloat(v));
  return neg ? '-' + res : res;
}

/* The answers table for sin, cos, tan at canonical angles (Q1).
   getAnswers returns [sin, cos, tan] (string/number/null).
*/
const answers = {
  0:    [0, 1, 0],
  30:   ['1/2', 'rt3/2', 'rt3/3'],
  45:   ['rt2/2', 'rt2/2', 1],
  60:   ['rt3/2', '1/2', 'rt3'],
  90:   [1, 0, null],
  120:  ['rt3/2', '-1/2', '-rt3'],
  135:  ['rt2/2', '-rt2/2', -1],
  150:  ['1/2', '-rt3/2', '-rt3/3'],
  180:  [0, -1, 0],
  210:  ['-1/2', '-rt3/2', rt3/3],
  225:  ['-rt2/2', '-rt2/2', 1],
  240:  ['-rt3/2', '-1/2', rt3],
  270:  [-1, 0, null],
  300:  ['-rt3/2', '1/2', '-rt3'],
  315:  ['-rt2/2', 'rt2/2', -1],
  330:  ['-1/2', 'rt3/2', '-rt3/3'],
  360:  [0, 1, 0]
};
function getAnswers(deg) {
  deg = ((deg % 360) + 360) % 360;

if (answers[deg] !== undefined) return answers[deg].slice();
if (deg === 360) return answers[0].slice(); // explicit 360
  deg = ((deg % 360) + 360) % 360; // normalize to 0–359

  // exact matches in Q1
  if (answers[deg]) return answers[deg].slice();

  // special cases
  if (deg === 180) { const t = answers[0].slice(); t[0] = 0; t[1] = -1; t[2] = 0; return t; }
  if (deg === 270) { const t = answers[90].slice(); t[0] = -1; t[1] = 0; t[2] = null; return t; }
  if (deg === 360) { const t = answers[0].slice(); return t; }

  // Quadrant logic
  let t;
  if (deg > 0 && deg < 90) { // Q1
    t = answers[deg].slice();
  } else if (deg > 90 && deg < 180) { // Q2
    t = answers[180 - deg].slice();
    t[0] = invertSign(t[0]); // sin positive
    t[1] = invertSign(t[1]); // cos negative
    t[2] = invertSign(t[2]); // tan negative
  } else if (deg > 180 && deg < 270) { // Q3
    t = answers[deg - 180].slice();
    t[0] = invertSign(t[0]); // sin negative
    t[1] = invertSign(t[1]); // cos negative
    t[2] = invertSign(t[2]); // tan positive
  } else if (deg > 270 && deg < 360) { // Q4
    t = answers[360 - deg].slice();
    t[0] = invertSign(t[0]); // sin negative
    t[1] = invertSign(t[1]); // cos positive
    t[2] = invertSign(t[2]); // tan negative
  } else {
    throw new Error('angle not supported: ' + deg);
  }
  return t;

  function invertSign(x) {
    if (x === null) return null;
    if (typeof x === 'number') return -x;
    if (typeof x === 'string') return x.startsWith('-') ? x.slice(1) : '-' + x;
    return x;
  }
}

/* Build problems based on options: returns array of {fn,arg,type,answer} */
function generateDrill(opts = {}) {
  const {
    useDegrees = true, radians = false,
    includeTan = false, includeCot = false, includeSec = false, includeCsc = false,
    deg90s = true, deg30s = true, deg45s = true, include360 = true, coterminal = false,
    quadIOnly = false
  } = opts;

  const problems = [];
  function addAngle(deg, includeCoterminals = true) {
    const [sin, cos, tan] = getAnswers(deg);
    if (includeCoterminals && coterminal) {
      if (deg !== 360) addAngle(deg - 360, false);
      addAngle(deg + 360, false);
    }
    if (useDegrees) {
      problems.push({fn:'sin', arg:deg, type:'degrees', answer:sin});
      problems.push({fn:'cos', arg:deg, type:'degrees', answer:cos});
      if (includeTan) problems.push({fn:'tan', arg:deg, type:'degrees', answer:tan});
      if (includeCot) problems.push({fn:'cot', arg:deg, type:'degrees', answer: invert(tan)});
      if (includeSec) problems.push({fn:'sec', arg:deg, type:'degrees', answer: invert(cos)});
      if (includeCsc) problems.push({fn:'csc', arg:deg, type:'degrees', answer: invert(sin)});
    }
    if (radians) {
      // if radians requested, use a simple fraction representation for common angles
      function toRad(d) {
  d = ((d % 360) + 360) % 360;  // ensure 0–359
  const map = {
    0: "0",
    30: "π/6",
    45: "π/4",
    60: "π/3",
    90: "π/2",
    120: "2π/3",
    135: "3π/4",
    150: "5π/6",
    180: "π",
    210: "7π/6",
    225: "5π/4",
    240: "4π/3",
    270: "3π/2",
    300: "5π/3",
    315: "7π/4",
    330: "11π/6",
    360: "2π"
  };
  return map[d] || (d/180) + "π";  // fallback for any other angle
}
      problems.push({fn:'sin', arg:toRad(deg), type:'radians', answer:sin});
      problems.push({fn:'cos', arg:toRad(deg), type:'radians', answer:cos});
      if (includeTan) problems.push({fn:'tan', arg:toRad(deg), type:'radians', answer:tan});
      if (includeCot) problems.push({fn:'cot', arg:toRad(deg), type:'radians', answer: invert(tan)});
      if (includeSec) problems.push({fn:'sec', arg:toRad(deg), type:'radians', answer: invert(cos)});
      if (includeCsc) problems.push({fn:'csc', arg:toRad(deg), type:'radians', answer: invert(sin)});
    }
  }

  if (deg90s) {
    addAngle(0);
    addAngle(90);
    if (!quadIOnly) { addAngle(180); addAngle(270); }
  }
  if (include360) addAngle(360);
  if (deg30s) {
    addAngle(30); addAngle(60);
    if (!quadIOnly) { addAngle(120); addAngle(150); addAngle(210); addAngle(240); addAngle(300); addAngle(330); }
  }
  if (deg45s) {
    addAngle(45);
    if (!quadIOnly) { addAngle(135); addAngle(225); addAngle(315); }
  }

  return problems;
}

/* ---------- UI wiring ---------- */
const checkboxes = {
  useDegrees: document.getElementById('degrees'),
  radians: document.getElementById('radian'),
  tan: document.getElementById('tan'),
  cot: document.getElementById('cot'),
  sec: document.getElementById('sec'),
  csc: document.getElementById('csc'),
  deg90s: document.getElementById('deg90s'),
  deg30s: document.getElementById('deg30s'),
  deg45s: document.getElementById('deg45s'),
  include360: document.getElementById('include360'),
  coterminal: document.getElementById('coterminal'),
  quadIOnly: document.getElementById('quadionly'),
  showCorrectness: document.getElementById('showcorrectness'),
  showCorrect: document.getElementById('showcorrect'),
  showTime: document.getElementById('showtime'),
  limit20: document.getElementById('limit20')
};

const problemsWrapper = document.getElementById('problems');
const solutions = document.getElementById('solutions');
const scoreEl = document.getElementById('score');
const clock = document.getElementById('clock');

let problems = [], current = 0, rights = 0, wrongs = 0, playing = false, startTime = 0, clockRAF = null;

function shuffle(arr) {
  for (let i=arr.length-1;i>0;i--) {
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

/* Build HTML for solution display map (so we can render answers in the problem area) */
const solutionHTMLs = {};
Array.from(solutions.children).forEach(el=>{
  solutionHTMLs[el.dataset.answer] = el.innerHTML;
  // allow also mapping for plain text like 'rt2' etc.
});

/* Format how an answer is printed in the problem-area (when revealed) */
function solutionFor(answer) {
  if (answer === null) return '<span class="small">undefined</span>';
  if (answer === 0 || answer === 1 || answer === -1) return String(answer);
  // prefer the provided solution HTML when available
  if (solutionHTMLs[answer]) return solutionHTMLs[answer];
  // fallback: prettify string
  return (''+answer).replace(/rt/g,'√');
}

/* format the displayed time */
function formatTime(ms) {
  const m = Math.floor(ms/60000).toString().padStart(2,'0');
  const s = Math.floor(ms/1000)%60;
  const sec = s.toString().padStart(2,'0');
  const ms3 = Math.floor(ms%1000).toString().padStart(3,'0');
  return `${m}:${sec}.${ms3}`;
}

function startClock() {
  const now = Date.now();
  clock.textContent = formatTime(now - startTime);
  clockRAF = requestAnimationFrame(startClock);
}

function stopClock() {
  if (clockRAF) cancelAnimationFrame(clockRAF);
  clockRAF = null;
}

/* render the current problems into the center column */
function renderProblems() {
  let html = '';
  problems.forEach((p, idx) => {
    const probClass = idx===current ? 'problem current' : 'problem';
    const answerHTML = (idx < current) ? `<span class="answer">${solutionFor(p.answer)}</span>` : `<span class="answer"></span>`;
    html += `<div class="${probClass}" data-index="${idx}">${answerHTML}<span><span class="fn">${p.fn}</span> `;

    if (p.type === 'degrees') {
      html += `${p.arg}&deg;`;
    } else if (p.type === 'radians') {
      // p.arg is a string like "π/6" or "2π/3"
      html += p.arg;
    }

    html += '</span></div>';
  });
  problemsWrapper.innerHTML = html;

  // highlight current
  const cur = problemsWrapper.querySelector('.problem.current');
  if (cur) cur.scrollIntoView({block:'center'});
  document.body.style.setProperty('--problem-n', current);

  // mark new current
  const next = problemsWrapper.children[current];
  if (next) next.classList.add('current');

}

/* hook up solution buttons */
solutions.addEventListener('click', e => {
  const el = e.target.closest('.solution');
  if (!el) return;
  const answer = el.dataset.answer;
  submitAnswer(answer);
});

/* right-click => submit negative version (if not 0/null) */
solutions.addEventListener('contextmenu', e => {
  const el = e.target.closest('.solution');
  if (!el) return;
  e.preventDefault();
  let ans = el.dataset.answer;
  if (ans === 'null') { submitAnswer('null'); return; }
  if (ans === '0') { submitAnswer('0'); return; }
  // toggle sign
  ans = ans.startsWith('-') ? ans.slice(1) : '-' + ans;
  submitAnswer(ans);
});

/* keyboard shortcuts - map some keys to the solution buttons (optional) */
document.addEventListener('keydown', e => {
  // map Q W E R T Y U I O P A S to the buttons
  const key = e.key.toUpperCase();
  const el = Array.from(solutions.children).find(c => c.dataset.key === key);
  if (el) {
    e.preventDefault();
    submitAnswer(el.dataset.answer);
  }
});

/* Start button: assemble options, create problems, shuffle, render, show UI */
document.getElementById('start').addEventListener('click', () => {
  if (playing) return;

  // collect options
  const opts = {};
  Object.keys(checkboxes).forEach(k => opts[k] = checkboxes[k].checked);

  // generate problems
  problems = shuffle(generateDrill({
    useDegrees: opts.useDegrees,
    radians: opts.radians,
    includeTan: opts.tan,
    includeCot: opts.cot,
    includeSec: opts.sec,
    includeCsc: opts.csc,
    deg90s: opts.deg90s,
    deg30s: opts.deg30s,
    deg45s: opts.deg45s,
    include360: opts.include360,
    coterminal: opts.coterminal,
    quadIOnly: opts.quadIOnly
  }));

  if (opts.limit20) problems = problems.slice(0,20);

  if (!problems.length) {
    alert('No problems with these options — try relaxing some filters.');
    return;
  }

  // reset state
  current = 0; rights = 0; wrongs = 0;

  // render problems and show UI
  renderProblems();
  document.body.classList.remove('show-intro-modal', 'show-score');
  document.body.classList.add('show-solutions');
  
  // show first problem fully
  const firstProblem = problemsWrapper.querySelector('.problem');
  if (firstProblem) firstProblem.scrollIntoView({ behavior: 'smooth', block: 'start' });

  // start clock
  startTime = Date.now();
  startClock();

  playing = true;
});
  
/* Menu (back to options) button on score modal */
document.getElementById('menu').addEventListener('click', () => {
  // hide score modal, return to options
  document.body.classList.remove('show-score');
  document.body.classList.add('show-intro-modal');
  solutions.setAttribute('aria-hidden','true');
  problemsWrapper.innerHTML = '';
});

/* initially hide solutions and problems until Start */
solutions.setAttribute('aria-hidden', 'true'); // keep for accessibility
document.body.classList.add('show-intro-modal');

function submitAnswer(answer) {
  if (!playing) return;

  const problem = problems[current];
  const correct = problem.answer;

  const problemEl = problemsWrapper.children[current];

  // normalize string answers
  const normalize = s => s === null || s === 'null' ? 'null' : (''+s).replace(/\s/g,'').replace('rt','√');
  const matched = normalize(answer) === normalize(correct);

  if (matched) {
    problemEl.classList.add('correct');
    rights++;
  } else {
    problemEl.classList.add('wrong');
    wrongs++;
    // reveal correct answer
    const ansSpan = problemEl.querySelector('.answer');
    if (ansSpan) ansSpan.innerHTML = solutionFor(correct);
  }

  // reveal user's answer (if not null)
  const userAnsSpan = problemEl.querySelector('.answer');
  if (userAnsSpan && answer !== 'null') userAnsSpan.innerHTML = solutionFor(answer);

  // move to next
  problemEl.classList.remove('current');
  current++;
  document.body.style.setProperty('--problem-n', current);
  if (current >= problems.length) {
    playing = false;
    stopClock();
    scoreEl.innerHTML = `It took you <strong>${formatTime(Date.now()-startTime)}</strong> to get <strong>${rights}</strong> out of ${problems.length} correct.`;
    document.body.classList.add('show-intro-modal','show-score');
    return;
  }

  const next = problemsWrapper.children[current];
  if (next) next.classList.add('current');
}
</script>
</body>
</html>
